import{q as V,r,j as e,C as X,a as h,I as Y,m,t as y}from"./app-CD6cBdKM.js";import{a as Z,D as ee}from"./layout-LS66cEvD.js";import{C as se,a as W}from"./Can-C76XOY1w.js";import{D as ne,a as ae,b as te,C as re}from"./confirm-dialog-CDC-gDHT.js";import{u as oe}from"./useLang-BvyXRUe-.js";import{p as ie}from"./settings-button-CCgOCwZr.js";import{R as B,P as x,a as F}from"./rights-Bhv2ANV4.js";import{u as le}from"./authz-DzcDTZqa.js";import{B as g}from"./Button--KfC8rp5.js";import{C as de}from"./Card-4eiaUBLO.js";import{S as D}from"./Stack-vomvaMcO.js";import{T}from"./TextField-Dh4fcTDh.js";import{I as ce}from"./InputAdornment-Bwj7yPg5.js";import{T as me,a as pe,b as ue,c as j,d as l,e as he}from"./TableHead-BPx6i0SZ.js";import{C as xe}from"./Checkbox-BMTKf5nZ.js";import{D as ge}from"./Dialog-CFRChwGj.js";import{M as je}from"./MenuItem-DmaGw-zu.js";import"./styles-gzNUAspH.js";import"./Popover-6bJkE66t.js";import"./createSvgIcon-BRtoGIw2.js";import"./useThemeProps-DzpMU5fq.js";import"./route-qstKo99j.js";import"./Tabs-CQmf7GIT.js";import"./merge-y9PmGEhP.js";import"./Link-DxKSdxqo.js";const fe={title:`Permissions | Dashboard - ${X.appName}`};function He({permissions:f,roles:c}){const{__:n}=oe(),{props:z}=V(),b=z.csrf_token,{can:k}=le(),q=k("PERMISSIONS_EDIT"),G=k("PERMISSIONS_DELETE"),[v,O]=r.useState(f),[p,H]=r.useState(""),[K,u]=r.useState(!1),C=Object.keys(x),[S,N]=r.useState(""),[R,L]=r.useState(C[0]),[E,I]=r.useState(null);r.useEffect(()=>{O(f)},[f]);const _=r.useMemo(()=>v.filter(s=>s.name.toLowerCase().includes(p.toLowerCase())||s.module.toLowerCase().includes(p.toLowerCase())),[v,p]),M=r.useMemo(()=>_.reduce((s,a)=>{var t;return(s[t=a.module]||(s[t]=[])).push(a),s},{}),[_]),[P,A]=r.useState({});r.useEffect(()=>{A(s=>{const a={...s};let t=!1;return Object.keys(M).forEach(i=>{a[i]===void 0&&(a[i]=!0,t=!0)}),t?a:s})},[M]);const U=s=>{A(a=>({...a,[s]:!a[s]}))},$=()=>{m.post(route("permissions.store"),{name:S,module:R,_token:b},{onSuccess:()=>{y.success(n("pages/permissions.add_permission")),u(!1),N(""),L(C[0]),m.reload({only:["permissions"]})}})},J=()=>{E!==null&&m.delete(route("permissions.destroy",E),{data:{_token:b},onSuccess:()=>{y.success(n("pages/permissions.delete_success")),I(null),m.reload({only:["permissions"]})}})},Q=(s,a,t)=>{const i=t?s.roles.filter(o=>o.id!==a).map(o=>o.id):[...s.roles.map(o=>o.id),a];m.patch(route("permissions.update",s.id),{roles:i,_token:b},{onSuccess:()=>{O(o=>o.map(d=>d.id===s.id?{...d,roles:t?d.roles.filter(w=>w.id!==a):[...d.roles,c.find(w=>w.id===a)]}:d))}})};return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:fe.title}),e.jsx(Z,{children:e.jsxs(ee,{maxWidth:"xl",children:[e.jsx(se,{heading:n("pages/permissions.breadcrumbs.permissions"),links:[{name:n("pages/permissions.breadcrumbs.dashboard"),href:ie.dashboard.root},{name:n("pages/permissions.breadcrumbs.permissions")}],action:e.jsx(W,{permission:"PERMISSIONS_CREATE",children:e.jsx(g,{variant:"contained",startIcon:e.jsx(h,{icon:"mingcute:add-line"}),onClick:()=>u(!0),children:n("pages/permissions.add_permission")})}),sx:{mb:{xs:3,md:5}}}),e.jsxs(de,{children:[e.jsx(D,{spacing:2,direction:{xs:"column",sm:"row"},sx:{p:2},children:e.jsx(T,{size:"small",value:p,onChange:s=>{H(s.target.value)},placeholder:n("pages/permissions.search"),InputProps:{startAdornment:e.jsx(ce,{position:"start",children:e.jsx(h,{icon:"solar:magnifer-linear",width:24})})}})}),e.jsx(me,{children:e.jsxs(pe,{children:[e.jsx(ue,{children:e.jsxs(j,{children:[e.jsx(l,{children:n("pages/permissions.table.name")}),c.map(s=>e.jsx(l,{align:"center",children:B[s.name]?n(B[s.name]):s.name},s.id)),e.jsx(l,{align:"center",children:n("pages/permissions.table.actions")})]})}),e.jsxs(he,{children:[Object.entries(M).map(([s,a])=>e.jsxs(r.Fragment,{children:[e.jsx(j,{children:e.jsx(l,{colSpan:c.length+2,onClick:()=>U(s),sx:{fontWeight:"bold",bgcolor:"background.neutral",cursor:"pointer"},children:e.jsxs(D,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(h,{width:16,icon:P[s]?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"}),x[s]?n(x[s]):s]})})}),P[s]&&a.map(t=>e.jsxs(j,{hover:!0,children:[e.jsx(l,{children:F[t.name]?n(F[t.name]):t.name}),c.map(i=>{const o=t.roles.some(d=>d.id===i.id);return e.jsx(l,{align:"center",children:e.jsx(xe,{checked:o,onChange:()=>Q(t,i.id,o),disabled:!q})},i.id)}),e.jsx(l,{align:"center",children:G&&e.jsx(Y,{color:"error",onClick:()=>I(t.id),children:e.jsx(h,{icon:"solar:trash-bin-trash-bold"})})})]},t.id))]},s)),_.length===0&&e.jsx(j,{children:e.jsx(l,{colSpan:c.length+2,align:"center",children:n("pages/permissions.no_data")})})]})]})})]})]})}),e.jsx(W,{permission:"PERMISSIONS_CREATE",children:e.jsxs(ge,{open:K,onClose:()=>u(!1),fullWidth:!0,maxWidth:"xs",children:[e.jsx(ne,{children:n("pages/permissions.add_permission")}),e.jsx(ae,{children:e.jsxs(D,{spacing:2,sx:{mt:1},children:[e.jsx(T,{autoFocus:!0,margin:"dense",fullWidth:!0,variant:"filled",label:n("pages/permissions.table.name"),value:S,onChange:s=>N(s.target.value)}),e.jsx(T,{select:!0,margin:"dense",fullWidth:!0,variant:"filled",label:n("pages/permissions.module"),value:R,onChange:s=>L(s.target.value),children:C.map(s=>e.jsx(je,{value:s,children:n(x[s])},s))})]})}),e.jsxs(te,{children:[e.jsx(g,{onClick:()=>u(!1),children:n("pages/permissions.cancel")}),e.jsx(g,{variant:"contained",onClick:$,disabled:!S,children:n("pages/permissions.add_permission")})]})]})}),e.jsx(re,{open:E!==null,onClose:()=>I(null),title:n("pages/permissions.delete_permission"),content:n("pages/permissions.delete_confirm"),action:e.jsx(g,{color:"error",variant:"contained",onClick:J,children:n("pages/permissions.delete")})})]})}export{He as default};
