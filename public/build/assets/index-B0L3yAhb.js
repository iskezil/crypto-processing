import{q as de,r as m,j as e,C as ue,a as r,I as d,L as me,t as j,m as B}from"./app-CD6cBdKM.js";import{a as pe,D as he,L as ge}from"./layout-LS66cEvD.js";import{u as xe}from"./useLang-BvyXRUe-.js";import{p as je,R as G}from"./settings-button-CCgOCwZr.js";import{r as P}from"./route-qstKo99j.js";import{u as be}from"./authz-DzcDTZqa.js";import{C as fe,a as Ce}from"./Can-C76XOY1w.js";import{UserStatusTabs as ve}from"./index-DFXxr6TB.js";import{UserTableToolbar as ye}from"./index-D3JfcImp.js";import{UserTableFiltersResult as we}from"./index-TSG4JwYh.js";import{UserDeleteDialog as Se}from"./index-DLBijlG1.js";import{B as Te}from"./Button--KfC8rp5.js";import{C as ke}from"./Card-4eiaUBLO.js";import{T as _e,a as Ee,b as Le,c as A,d as c,e as Ie}from"./TableHead-BPx6i0SZ.js";import{b as H,S as W}from"./TextField-Dh4fcTDh.js";import{S as f}from"./Stack-vomvaMcO.js";import{M as J}from"./MenuItem-DmaGw-zu.js";import{C as ze}from"./Checkbox-BMTKf5nZ.js";import{T as Re}from"./TablePagination-n4U631vZ.js";import"./styles-gzNUAspH.js";import"./Popover-6bJkE66t.js";import"./createSvgIcon-BRtoGIw2.js";import"./useThemeProps-DzpMU5fq.js";import"./Dialog-CFRChwGj.js";import"./InputAdornment-Bwj7yPg5.js";import"./Tabs-CQmf7GIT.js";import"./merge-y9PmGEhP.js";import"./Link-DxKSdxqo.js";import"./Chip-BNrhAUiE.js";import"./confirm-dialog-CDC-gDHT.js";const Pe={title:`Users | Dashboard - ${ue.appName}`};function ds({users:T,roles:k}){var q;const{__:n}=xe(),{props:D}=de(),M=D.csrf_token;console.log("props.auth.user",D.auth.user);const Q=(q=D.auth.user)==null?void 0:q.id,{can:O}=be(),C=O("USERS_EDIT"),X=O("USERS_DELETE"),[v,F]=m.useState(T),[u,$]=m.useState({keyword:"",role:null,status:"all"}),[_,E]=m.useState(0),[y,Y]=m.useState(5),[p,g]=m.useState({id:null,field:null}),[U,L]=m.useState(null),N=(s,t)=>{$(i=>({...i,[s]:t})),E(0)},Z=()=>{$({keyword:"",role:null,status:"all"}),E(0)},I=(s,t,i)=>{F(a=>a.map(o=>o.id===s?{...o,[t]:i}:o))},b=(s,t,i)=>{const a=v.find(l=>l.id===s),o=T.find(l=>l.id===s);if(!a||!o)return;const R={_token:M};let x=!1;const ie=()=>F(l=>l.map(h=>h.id===s?o:h));if(t==="roles"){const l=i??a.roles,h=[...o.roles];l.sort(),h.sort(),x=l.length!==h.length||l.some((re,ce)=>re!==h[ce]),x&&(R.roles=l)}else if(t==="status"){const l=i??a.status;x=l!==o.status,x&&(R.status=l)}else{const l=i??a[t],h=o[t];x=l!==h,x&&(R[t]=l)}if(!x){g({id:null,field:null}),ie();return}B.patch(P("users.update",s),R,{onSuccess:()=>{j.success(n("pages/users.update_success"))},onError:l=>{j.error(l.roles??n("pages/users.update_error"))}}),g({id:null,field:null})},ee=[{value:"all",label:n("pages/users.tabs.all")},{value:"active",label:n("pages/users.tabs.active")},{value:"pending",label:n("pages/users.tabs.pending")},{value:"banned",label:n("pages/users.tabs.banned")}],se=[{value:"active",label:n("pages/users.statuses.active")},{value:"pending",label:n("pages/users.statuses.pending")},{value:"banned",label:n("pages/users.statuses.banned")}],z=m.useMemo(()=>v.filter(s=>(s.name.toLowerCase().includes(u.keyword.toLowerCase())||s.email.toLowerCase().includes(u.keyword.toLowerCase()))&&(!u.role||s.roles.includes(u.role))&&(u.status==="all"||s.status===u.status)),[v,u]),V=m.useMemo(()=>z.slice(_*y,_*y+y),[z,_,y]),ae=(s,t)=>{E(t)},te=s=>{Y(parseInt(s.target.value,10)),E(0)},ne=(s,t)=>{N("status",t)},le=s=>s==="all"?v.length:v.filter(t=>t.status===s).length,K=s=>{const t=k.find(i=>i.id===s);return t?n(`pages/users.roles.${t.name.toLowerCase()}`):""},w=async s=>{var i;if((i=navigator.clipboard)!=null&&i.writeText)try{await navigator.clipboard.writeText(s),j.success(n("pages/users.copy_success"));return}catch{}const t=document.createElement("textarea");t.value=s,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),j.success(n("pages/users.copy_success"))}finally{document.body.removeChild(t)}},S={"& .action-icons":{display:"inline-flex",opacity:0,visibility:"hidden",pointerEvents:"none",transition:"opacity 0.2s"},"&:hover .action-icons":{opacity:1,visibility:"visible",pointerEvents:"auto"}};m.useEffect(()=>{F(T)},[T]);const oe=()=>{U!==null&&B.delete(P("users.destroy",U),{data:{_token:M},onSuccess:()=>{j.success(n("pages/users.delete_success")),L(null),B.reload({only:["users"]})},onError:s=>{j.error(s.user??n("pages/users.delete_error")),L(null)}})};return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:Pe.title}),e.jsx(pe,{children:e.jsxs(he,{maxWidth:"xl",children:[e.jsx(fe,{heading:n("pages/users.breadcrumbs.users"),links:[{name:n("pages/users.breadcrumbs.dashboard"),href:je.dashboard.root},{name:n("pages/users.breadcrumbs.users")}],action:e.jsx(Ce,{permission:"USERS_CREATE",children:e.jsx(Te,{component:G,href:P("users.create"),variant:"contained",startIcon:e.jsx(r,{icon:"mingcute:add-line"}),children:n("pages/users.add_user")})}),sx:{mb:{xs:3,md:5}}}),e.jsxs(ke,{children:[e.jsx(ve,{value:u.status,onChange:ne,tabs:ee,getCount:le}),e.jsx(ye,{filters:u,onFilters:N,roles:k}),e.jsx(we,{filters:u,onFilters:N,onResetFilters:Z,results:z.length,roles:k}),e.jsx(_e,{children:e.jsxs(Ee,{children:[e.jsx(Le,{children:e.jsxs(A,{children:[e.jsx(c,{children:n("pages/users.table.name")}),e.jsx(c,{children:n("pages/users.table.email")}),e.jsx(c,{children:n("pages/users.table.status")}),e.jsx(c,{children:n("pages/users.table.role")}),e.jsx(c,{children:n("pages/users.table.created")}),e.jsx(c,{align:"center",children:n("pages/users.table.actions")})]})}),e.jsxs(Ie,{children:[V.map(s=>{const t=s.roles.length?s.roles.map(K).join(", "):"-",i=n(`pages/users.statuses.${s.status}`);return e.jsxs(A,{hover:!0,children:[e.jsx(c,{children:p.id===s.id&&p.field==="name"?e.jsx(H,{value:s.name,size:"small",hiddenLabel:!0,autoFocus:!0,onChange:a=>I(s.id,"name",a.target.value),onBlur:()=>b(s.id,"name"),onKeyDown:a=>{a.key==="Enter"&&b(s.id,"name")}}):e.jsxs(f,{direction:"row",spacing:.5,alignItems:"center",sx:S,children:[s.name,C&&e.jsx(d,{className:"action-icons",size:"small",onClick:()=>g({id:s.id,field:"name"}),children:e.jsx(r,{icon:"solar:pen-bold",width:16})}),e.jsx(d,{className:"action-icons",size:"small",onClick:()=>w(s.name),children:e.jsx(r,{icon:"solar:copy-bold",width:16})})]})}),e.jsx(c,{children:p.id===s.id&&p.field==="email"?e.jsx(H,{value:s.email,size:"small",hiddenLabel:!0,autoFocus:!0,onChange:a=>I(s.id,"email",a.target.value),onBlur:()=>b(s.id,"email"),onKeyDown:a=>{a.key==="Enter"&&b(s.id,"email")}}):e.jsxs(f,{direction:"row",spacing:.5,alignItems:"center",sx:S,children:[s.email,C&&e.jsx(d,{className:"action-icons",size:"small",onClick:()=>g({id:s.id,field:"email"}),children:e.jsx(r,{icon:"solar:pen-bold",width:16})}),e.jsx(d,{className:"action-icons",size:"small",onClick:()=>w(s.email),children:e.jsx(r,{icon:"solar:copy-bold",width:16})})]})}),e.jsx(c,{children:p.id===s.id&&p.field==="status"?e.jsx(W,{autoFocus:!0,open:!0,size:"small",variant:"filled",hiddenLabel:!0,value:s.status,onChange:a=>{const o=a.target.value;I(s.id,"status",o),b(s.id,"status",o)},onClose:()=>g({id:null,field:null}),children:se.map(a=>e.jsx(J,{value:a.value,children:a.label},a.value))}):e.jsxs(f,{direction:"row",spacing:.5,alignItems:"center",sx:S,children:[e.jsx(me,{color:s.status==="active"&&"success"||s.status==="pending"&&"warning"||s.status==="banned"&&"error"||"default",children:i}),C&&e.jsx(d,{className:"action-icons",size:"small",onClick:()=>g({id:s.id,field:"status"}),children:e.jsx(r,{icon:"solar:pen-bold",width:16})}),e.jsx(d,{className:"action-icons",size:"small",onClick:()=>w(i),children:e.jsx(r,{icon:"solar:copy-bold",width:16})})]})}),e.jsx(c,{children:p.id===s.id&&p.field==="roles"?e.jsx(W,{autoFocus:!0,open:!0,multiple:!0,size:"small",variant:"filled",hiddenLabel:!0,value:s.roles,onChange:a=>{const o=a.target.value;I(s.id,"roles",o)},renderValue:a=>a.map(K).join(", "),onClose:()=>b(s.id,"roles"),children:k.map(a=>{const o=a.name.toLowerCase();return e.jsxs(J,{value:a.id,children:[e.jsx(ze,{checked:s.roles.includes(a.id)}),e.jsx(ge,{primary:n(`pages/users.roles.${o}`)})]},a.id)})}):e.jsxs(f,{direction:"row",spacing:.5,alignItems:"center",sx:S,children:[t,C&&e.jsx(d,{className:"action-icons",size:"small",onClick:()=>g({id:s.id,field:"roles"}),children:e.jsx(r,{icon:"solar:pen-bold",width:16})}),e.jsx(d,{className:"action-icons",size:"small",onClick:()=>w(t),children:e.jsx(r,{icon:"solar:copy-bold",width:16})})]})}),e.jsx(c,{children:e.jsxs(f,{direction:"row",spacing:.5,alignItems:"center",sx:S,children:[s.created_at,e.jsx(d,{className:"action-icons",size:"small",onClick:()=>w(s.created_at),children:e.jsx(r,{icon:"solar:copy-bold",width:16})})]})}),e.jsx(c,{align:"center",children:e.jsxs(f,{direction:"row",spacing:1,justifyContent:"center",children:[e.jsx(d,{size:"small",children:e.jsx(r,{icon:"solar:eye-bold"})}),C&&e.jsx(d,{component:G,href:P("users.edit",s.id),size:"small",color:"primary",children:e.jsx(r,{icon:"solar:pen-bold"})}),X&&e.jsx(d,{size:"small",color:"error",onClick:()=>{s.id===Q?j.error(n("pages/users.self_delete_error")):L(s.id)},children:e.jsx(r,{icon:"solar:trash-bin-trash-bold"})})]})})]},s.id)}),V.length===0&&e.jsx(A,{children:e.jsx(c,{colSpan:6,align:"center",children:n("pages/users.no_data")})})]})]})}),e.jsx(Re,{component:"div",count:z.length,page:_,onPageChange:ae,rowsPerPage:y,onRowsPerPageChange:te,rowsPerPageOptions:[5,10,25]})]})]})}),e.jsx(Se,{open:U!==null,onClose:()=>L(null),onDelete:oe})]})}export{ds as default};
